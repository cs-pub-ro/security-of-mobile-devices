# Android Static Analysis

The aim of this lab is to get you accustomed to the basic static analysis tools in the Android ecosystem.
The target of static analysis are either full Android filesystem images or application packages (APK files).
Typically, you do forensics analysis on both types of targets, looking for user identification, private information, passwords.
You also do security assessments looking for misconfigurations, software vulnerabilities and design weaknesses.

In this lab we make use of the following tools:

- [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF) (Mobile Security Framework): is an automated, all-in-one mobile application pen-testing.
- [Jadx](https://github.com/skylot/jadx): is a DEX to Java decompiler, producing Java source code from Android DEX and APK files.
- [Apktool](https://github.com/iBotPeaches/Apktool): is a tool for reverse engineering third-party, closed, binary, Android apps.

## Prerequisites

For this task we aim to understand the reports generated by MobSF.

### Install Docker

Install Docker on a Linux host following [these steps](https://docs.docker.com/engine/install/ubuntu/).
You can skip this step if you have Docker already installed.

### Run the MobSF Docker Image

```console
docker pull opensecurity/mobile-security-framework-mobsf:latest
docker run -it --rm -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```

Open the link `http://localhost:8000`

> [!NOTE]
> If you installed docker on another machine, then use the link `http://<DOCKER_HOST_IP>:8000`

###  Jadx - Dex to Java decompiler

[Jadx](https://github.com/skylot/jadx) is a command-line and GUI tool for producing Java source code from Android DEX and APK files.
It allows you to look at readable code for the targeted application.

### Apktool

[Apktool](https://github.com/iBotPeaches/Apktool) is a tool for reverse engineering Android APK files.
Apktool can decode and then rebuild your application.
It can debug the application.
It decodes / disassembles both application code and resource files.

Also check [the docs](https://apktool.org/docs/build).

## Task 0: Introduction

The `AndroidManifest.xml` file of an Android application (also part of the APK file) contains essential information about the app, declaring the components of the app like `minSDKVersion`, `Permissions`, `Activities`, `Services`, `Content Providers`, `Intent Filters`, `Debugging Info`, etc.

Download the [`APKPure` app](https://apkpure.com/) and follow [this tutorial](https://medium.com/@HirushanTech/static-analysis-and-dynamic-analysis-over-android-package-file-apk-6721830cb155) on using Apktool.

## Task 1: Static Analysis of APK files Using MobSF

Use the [`InjuredAndroid` APK file](https://github.com/B3nac/InjuredAndroid).
Try to follow [this walkthrough](https://www.hackingarticles.in/android-pentest-automated-analysis-using-mobsf/) until the `Dynamic Analyzer` step.

## Task 2: Samsung CTF: Find the password

There is a flag in [this APK file](https://github.com/FrigidSec/CTFWriteups/blob/master/SCTF/Vault101/_docs/challengeApp/Vault101-1.1-release.apk).
Follow [this tutorial](https://saketupadhyay.com/blog/posts/sstf-vault-wtireup/) or [this one](https://infosecwriteups.com/vault-101-samsung-ctf-android-reverse-engineering-challenge-write-up-d5a2b16a9212) and try to find what the flag is.

## Task 3: The 9 flags from `InjuredAndroid` APK

Follow [this walkthrough](https://blog.syselement.com/tcm/courses/mapt/4-android-static) and find the 9 flags in the [`InjuredAndroid` APK file](https://github.com/B3nac/InjuredAndroid).

### Bonus: DIVA Android

[DIVA](https://github.com/payatu/diva-android) (_Damn Insecure and Vulnerable App_) is an Android application intentionally designed to be insecure.

Aim to solve all the 13 challenges in the [DIVA repository](https://github.com/payatu/diva-android).

Use the walkthroughs below to assist you in solving the challenges:

- https://medium.com/@thecyberprince/diva-beta-android-app-walkthrough-4b0f114aa74
- https://medium.com/@0x3adly/android-static-code-analysis-57a9827ab164
- https://freedium.cfd/https://infosecwriteups.com/hunting-for-bugs-in-android-app-fe9158a556d3

## Other Resources

- [Getting Started Into Android Security Part 2](https://securityboat.net/getting-started-into-android-security-part-2/)
